import{e as R,A as T,f as J,b as Q,a as V,_ as x,c as q,u as K}from"./index-Dv-qMdo4.js";import{f as Z,a as p,s as ee,t as O,p as se,a9 as re,q as v,G as ae,n as te,d as k,_ as G,U as h,V as E,F as z,m as P,W as S,Y as C,M,a8 as I,Z as b,X as D,N as B}from"./vue-vendor-DGfeFLTS.js";import{l as oe,p as L,f as ne,u as le,e as ue}from"./vuetify-vendor-ZlQH_a5_.js";const ie={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_ENDPOINT:"https://www.snipbee.com/"},de=ie,ce=T,me=async(d,_)=>{let s;try{if(s=await fetch(de.VITE_API_ENDPOINT+"api/auth/change-password",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(_)}),s.status===404)throw new Error(`${s.url} Not Found.`);if(s.status===401)throw new Error("Unauthorized")}catch(n){return{error:R(n)}}let l;try{if(l=await s.json(),l===null)return{error:`${ce.CHANGE_PASS_ERROR}`}}catch(n){return{error:R(n)}}return l.error?{error:l.error}:l},fe={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_ENDPOINT:"https://www.snipbee.com/"},ve=fe,_e=T,ge=async(d,_)=>{let s;try{if(s=await fetch(ve.VITE_API_ENDPOINT+"api/auth/change-username",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(_)}),s.status===404)throw new Error(`${s.url} Not Found.`);if(s.status===401)throw new Error("Unauthorized")}catch(n){return{error:R(n)}}let l;try{if(l=await s.json(),l===null)return{error:`${_e.CHANGE_USER_ERROR}`}}catch(n){return{error:R(n)}}return l.error?{error:l.error}:l},pe=Symbol.for("vuetify:form"),we=L({disabled:Boolean,fastFail:Boolean,readonly:Boolean,modelValue:{type:Boolean,default:null},validateOn:{type:String,default:"input"}},"form");function he(d){const _=oe(d,"modelValue"),s=O(()=>d.disabled),l=O(()=>d.readonly),n=ee(!1),a=p([]),c=p([]);async function g(){const t=[];let u=!0;c.value=[],n.value=!0;for(const i of a.value){const e=await i.validate();if(e.length>0&&(u=!1,t.push({id:i.id,errorMessages:e})),!u&&d.fastFail)break}return c.value=t,n.value=!1,{valid:u,errors:c.value}}function w(){a.value.forEach(t=>t.reset())}function f(){a.value.forEach(t=>t.resetValidation())}return Z(a,()=>{let t=0,u=0;const i=[];for(const e of a.value)e.isValid===!1?(u++,i.push({id:e.id,errorMessages:e.errorMessages})):e.isValid===!0&&t++;c.value=i,_.value=u>0?!1:t===a.value.length?!0:null},{deep:!0,flush:"post"}),se(pe,{register:t=>{let{id:u,vm:i,validate:e,reset:o,resetValidation:N}=t;a.value.some(A=>A.id===u),a.value.push({id:u,validate:e,reset:o,resetValidation:N,vm:re(i),isValid:null,errorMessages:[]})},unregister:t=>{a.value=a.value.filter(u=>u.id!==t)},update:(t,u,i)=>{const e=a.value.find(o=>o.id===t);e&&(e.isValid=u,e.errorMessages=i)},isDisabled:s,isReadonly:l,isValidating:n,isValid:_,items:a,validateOn:O(()=>d.validateOn)}),{errors:c,isDisabled:s,isReadonly:l,isValidating:n,isValid:_,items:a,validate:g,reset:w,resetValidation:f}}const ye=L({...ue(),...we()},"VForm"),H=ne()({name:"VForm",props:ye(),emits:{"update:modelValue":d=>!0,submit:d=>!0},setup(d,_){let{slots:s,emit:l}=_;const n=he(d),a=p();function c(w){w.preventDefault(),n.reset()}function g(w){const f=w,t=n.validate();f.then=t.then.bind(t),f.catch=t.catch.bind(t),f.finally=t.finally.bind(t),l("submit",f),f.defaultPrevented||t.then(u=>{let{valid:i}=u;i&&a.value?.submit()}),f.preventDefault()}return le(()=>v("form",{ref:a,class:te(["v-form",d.class]),style:ae(d.style),novalidate:!0,onReset:c,onSubmit:g},[s.default?.(n)])),J(n,a)}}),Ne={class:"change_buttons"},Pe={key:0,class:"form_container"},Se={class:"control"},Ee={class:"control"},be={class:"action"},Ce={key:1,class:"form_container"},Ae={class:"control"},Ue={class:"action"},Ve=k({__name:"ProfileForm",props:{onChangePassword:{type:Function},onChangeUsername:{type:Function},userName:{}},setup(d){const _=Q(),s=T,l=d,n=O(l,"userName"),a=p(""),c=p(""),g=p(l.userName||"");let w=l.onChangePassword,f=l.onChangeUsername;const t=p(!1),u=p(!1),i=p(!1),e=p({error_state:!1,error_severity:"",message:""}),o=()=>{i.value=!0,e.value={error_state:!1,error_severity:"",message:""}},N=()=>{o();const m=g.value;m.length<s.USERNAME_MIN||m===void 0?(i.value=!1,e.value={error_state:!0,error_severity:"warning",message:s.CHANGE_USER_TOO_FEW}):m.length>s.USERNAME_MAX?(i.value=!1,e.value={error_state:!0,error_severity:"warning",message:s.CHANGE_USER_TOO_MANY}):m===n.value?(i.value=!1,e.value={error_state:!0,error_severity:"warning",message:s.CHANGE_USER_UNIQUE}):o()},A=()=>{o();const m=a.value||"",r=c.value||"";m.length<s.PASSWORD_MIN||r.length<s.PASSWORD_MIN?(i.value=!1,e.value={error_state:!0,error_severity:"warning",message:s.CHANGE_PASS_TOO_FEW}):m.length>s.PASSWORD_MAX||r.length>s.PASSWORD_MAX?(i.value=!1,e.value={error_state:!0,error_severity:"warning",message:s.CHANGE_PASS_TOO_MANY}):m&&r&&m===r?(i.value=!1,e.value={error_state:!0,error_severity:"warning",message:s.CHANGE_PASS_UNIQUE}):o()},W=m=>{m.preventDefault();const r=g.value;r&&(f({newUsername:r}),$(),F("User name changed!"))},j=m=>{m.preventDefault();const r=a.value,U=c.value;!r||!U||(w({oldPassword:r,newPassword:U}),$(),F("Password changed!"))},F=m=>{_.ShowSnack({n_status:!0,message:m})},$=()=>{o(),t.value=!1,u.value=!1,a.value="",c.value="",g.value=l.userName||""},X=()=>{o(),t.value=!t.value,u.value=!1,t.value&&(g.value=l.userName||"")},Y=()=>{o(),u.value=!u.value,t.value=!1};return(m,r)=>{const U=G("ErrorAlert");return h(),E(z,null,[v("div",Ne,[P(V,{"mat-button":"",color:"secondary","aria-label":"User Name button",class:"contained medium",onClick:X},{default:S(()=>[...r[5]||(r[5]=[C(" User Name ",-1)])]),_:1}),P(V,{"mat-button":"",color:"secondary","aria-label":"Password button",class:"contained medium",onClick:Y},{default:S(()=>[...r[6]||(r[6]=[C(" Password ",-1)])]),_:1})]),u.value?(h(),E("div",Pe,[P(H,{class:"form",onSubmit:r[2]||(r[2]=y=>j(y))},{default:S(()=>[v("div",Se,[r[7]||(r[7]=v("label",{for:"new-password"},"New Password",-1)),M(v("input",{autoComplete:"New Password",type:"password",id:"new-password","onUpdate:modelValue":r[0]||(r[0]=y=>c.value=y),onInput:o,onBlur:A},null,544),[[I,c.value]])]),v("div",Ee,[r[8]||(r[8]=v("label",{for:"old-password"},"Old Password",-1)),M(v("input",{autoComplete:"Old Password",type:"password",id:"old-password","onUpdate:modelValue":r[1]||(r[1]=y=>a.value=y),onInput:o,onBlur:A},null,544),[[I,a.value]])]),v("div",be,[P(V,{type:"submit",color:"secondary","aria-label":"Change Password button",class:"contained medium",disabled:!i.value},{default:S(()=>[...r[9]||(r[9]=[C(" Change Password ",-1)])]),_:1},8,["disabled"])])]),_:1})])):b("",!0),t.value?(h(),E("div",Ce,[P(H,{class:"form",onSubmit:W},{default:S(()=>[v("div",Ae,[r[10]||(r[10]=v("label",{for:"new-username"},"User Name",-1)),M(v("input",{"onUpdate:modelValue":r[3]||(r[3]=y=>g.value=y),type:"text",id:"new-username",onInput:r[4]||(r[4]=y=>N())},null,544),[[I,g.value]])]),v("div",Ue,[P(V,{type:"submit",color:"secondary","aria-label":"Change User Name button",class:"contained medium",disabled:!i.value},{default:S(()=>[...r[11]||(r[11]=[C(" Change User Name ",-1)])]),_:1},8,["disabled"])])]),_:1})])):b("",!0),e.value.error_state?(h(),D(U,{key:2,error_severity:e.value.error_severity,error_state:e.value.error_state,message:e.value.message},null,8,["error_severity","error_state","message"])):b("",!0)],64)}}}),Oe=x(Ve,[["__scopeId","data-v-8d0c63b6"]]),Re={class:"page_scrollable_header_breadcrumb_list"},Me={key:2,class:"profile"},Ie=k({__name:"UserProfile",setup(d){const _=q(),s=K(),l=p(null),n=p(),a=p(),c=p();let g;const w=e=>{l.value=e.loading,n.value=e.token,a.value=e.success,c.value=e.details,g=e.onLogout};s.$subscribe((e,o)=>{w(o.authContext)});const f=e=>{_.ShowNotification({notification:{n_status:"error",title:"Error!",message:e}})},t=async e=>{if(n.value)try{const o=await me(n.value,e);if(o.error){f(`${o.error}`);return}}catch(o){f(`${o}`);return}},u=async e=>{if(n.value)try{const o=await ge(n.value,e);if(o.error){f(`${o.error}`);return}if(o.error==="Unauthorized"){g&&g();return}if(o.success){const N={...s.authContext};s.authContext={...N,success:o.success,details:o.details,loading:!1}}}catch(o){f(`${o}`);return}};return(async()=>{const e=await s.getAuth();e.value!==null&&w(e.value)})(),(e,o)=>{const N=G("LoadingScreen");return h(),E("div",Re,[a.value?b("",!0):(h(),D(N,{key:0})),a.value&&!n.value?(h(),E(z,{key:1},[C("Unauthorized")],64)):b("",!0),a.value&&n.value&&c.value?(h(),E("section",Me,[v("h2",null,B(c.value.username),1),v("h3",null,B(c.value.email),1),P(Oe,{userName:c.value.username,onChangePassword:t,onChangeUsername:u},null,8,["userName"])])):b("",!0)])}}}),Te=x(Ie,[["__scopeId","data-v-72b1d248"]]),$e=k({__name:"ProfilePage",setup(d){return(_,s)=>(h(),D(Te))}});export{$e as default};
