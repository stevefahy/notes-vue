import{d as Y,f as I,V as E,n as re,m as $,W as S,t as F,U as c,q as d,X as N,Z as v,a as u,I as Te,aa as Se,a0 as ge,ad as xe,u as C,F as ye,$ as Ee,Y as L,D as Ne,_ as ke}from"./vue-vendor-DGfeFLTS.js";import{e as M,A as j,d as Ve,u as Ce,g as Ie,c as $e,b as Re,l as ne,a as D}from"./index-Dv-qMdo4.js";import{b as Ae,V as Oe,m as Me,g as Pe}from"./ViewNoteMarkdown-Dx3lLV6h.js";import{V as Le,F as De}from"./FooterView-B3LtViKB.js";import{V as le,b as ie}from"./VCard-DjaoZtbU.js";import"./vuetify-vendor-ZlQH_a5_.js";const Be={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_ENDPOINT:"https://www.snipbee.com/"},ze=Be,Ue=j,Fe=async(r,o)=>{let t;try{if(t=await fetch(ze.VITE_API_ENDPOINT+"api/data/create-note",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(o)}),t.status===404)throw new Error(`${t.url} Not Found.`)}catch(n){return{error:M(n)}}let a;try{if(a=await t.json(),a===null)return{error:`${Ue.NOTE_CREATE_ERROR}`}}catch(n){return{error:M(n)}}return a.error?{error:a.error}:a},je={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_ENDPOINT:"https://www.snipbee.com/"},He=je,We=j,qe=async(r,o,t)=>{let a;try{if(a=await fetch(He.VITE_API_ENDPOINT+`api/data/notebook/${o}/${t}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}}),a.status===404)throw new Error(`${a.url} Not Found.`)}catch(l){return{error:M(l)}}let n;try{if(n=await a.json(),n===null)return{error:`${We.NOTE_ERROR}`}}catch(l){return{error:M(l)}}return n.error?{error:n.error}:n},Je={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_ENDPOINT:"https://www.snipbee.com/"},Ge=Je,Xe=j,Ye=async(r,o,t,a)=>{let n;const l={notebookID:o,noteID:t,note:a};try{if(n=await fetch(Ge.VITE_API_ENDPOINT+"api/data/save-note",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(l)}),n.status===404)throw new Error(`${n.url} Not Found.`)}catch(w){return{error:M(w)}}let i;try{if(i=await n.json(),i===null)return{error:`${Xe.NOTE_SAVE_ERROR}`}}catch(w){return{error:M(w)}}return i.error?{error:i.error}:i},Ze="/assets/images/split_screen_icon_single.png",Ke="/assets/images/split_screen_icon_double.png";let O=!1,R,A;const Qe=()=>{R=document.querySelector("#edit"),A=document.querySelector("#view"),tt()},ue=(r,o)=>{const t=o.scrollHeight-o.clientHeight,a=r.scrollTop/(r.scrollHeight-r.clientHeight)*100;return t*(a/100)},et=()=>{R?.removeEventListener("scroll",ce),A?.removeEventListener("scroll",de)},ce=()=>{const r=A,t=ue(R,r),a=O;O=!1,!a&&(O=!0,r.scrollTop=t)},de=()=>{const r=A,o=R,t=ue(r,o),a=O;O=!1,!a&&(O=!0,o.scrollTop=t)},tt=()=>{A!==null&&R!==null&&R.addEventListener("scroll",ce),A!==null&&R!==null&&A.addEventListener("scroll",de)},ot={id:"viewnote_id",class:"viewnote_content viewer viewnote_content"},at=Y({__name:"ViewNote",props:{visible:{type:Boolean},splitScreen:{type:Boolean},viewText:{},updatedViewText:{type:Function}},setup(r){globalThis.Buffer=Ae.Buffer;const o=r;let t;const a=u(""),n=u(!1),l=F(o,"viewText"),i=F(o,"splitScreen"),w=F(o,"visible");let k;const B=()=>{k=setTimeout(()=>{n.value=!0,clearTimeout(k)},300)};I(l,p=>{t=Me(p).content,a.value=t,B()},{deep:!0,immediate:!0});const _=p=>{o.updatedViewText(p)};return(p,H)=>(c(),E("div",{id:"view",class:re({view:!0,"view_split show":i.value,editnote_box:!0,show:w.value,hide:!w.value})},[$(le,null,{default:S(()=>[$(ie,{class:"cardcontent"},{default:S(()=>[d("article",ot,[n.value?v("",!0):(c(),N(Le,{key:0,type:"list-item"})),n.value?(c(),N(Oe,{key:1,splitScreen:i.value,viewText:a.value,updatedViewText:_,disableLinks:!1},null,8,["splitScreen","viewText"])):v("",!0)])]),_:1})]),_:1})],2))}}),st={class:"viewnote_content editor"},nt=["contentEditable"],rt=Y({__name:"EditNote",props:{visible:{type:Boolean},splitScreen:{type:Boolean},loadedText:{},updateViewText:{type:Function},passUpdatedViewText:{}},setup(r){const o=r,t=u(null),a=F(o,"passUpdatedViewText");I(a,l=>{t.value&&t.value.innerText!==l&&(t.value.innerText=l)}),Te(()=>{o.loadedText===""&&t.value&&t.value.focus(),o.loadedText&&t.value&&(t.value.innerText=o.loadedText)});const n=l=>{o.updateViewText(l.currentTarget.innerText)};return(l,i)=>(c(),E("div",{id:"edit",class:re({"edit editnote_box":!0,"show editting":o.visible})},[$(le,null,{default:S(()=>[$(ie,null,{default:S(()=>[d("article",st,[d("div",{ref_key:"noteInputRef",ref:t,contentEditable:o.visible||o.splitScreen,class:"viewnote_content editable",onInput:i[0]||(i[0]=w=>n(w)),"data-placeholder":"Start writing...'"},null,40,nt)])]),_:1})]),_:1})],2))}}),lt={class:"page_scrollable_header_breadcrumb_footer"},it={key:0,class:"view_container",id:"view_container"},ut={key:0,class:"icon_text"},ct={key:1,class:"icon_text"},dt={key:0,className:"split_screen_icon"},vt={key:1,className:"split_screen_icon"},Tt=Y({__name:"NotePage",setup(r){const o=Ve(),{btnSize:t}=Se(o),a=Ce(),n=Ie(),l=$e(),i=Re(),w=j,k=Ne(),B=Ee(),_=B.params.notebookId,p=B.params.noteId;let H,f,W=!1,Z=ne().value.width;const K=u(""),m=u(""),Q=u(""),z=u(!1),q=u(""),ee=u(""),b=u(!1),P=u(!1),V=u(!1),h=u(!1),g=u(W),T=u(W),x=u(!1),J=ne().value;J.addListener(),ge(()=>{et(),J.removeListener()}),xe((e,s,X)=>{H=e.fullPath,h.value&&!g.value&&(V.value=!0),X()}),setTimeout(()=>{Qe()},500),p==="create-note"&&(W=!0,g.value=!0,T.value=!0);const te=()=>{Z<w.SPLITSCREEN_MINIMUM_WIDTH?(x.value=!1,z.value=!0):z.value=!1};I(J,e=>{Z=e.width,te()}),I(V,e=>{e&&(U(),ve())}),I(h,e=>{e&&U()}),I(T,e=>{e&&U()}),I(g,e=>{e&&U()});const ve=()=>{i.ShowSnack({n_status:!0,message:"Note Saved"})},_e=()=>{z.value||(x.value=!0),G(K.value)},G=e=>{pe(e),m.value=e,ee.value=e},pe=e=>{e!==q.value?h.value=!0:h.value=!1},fe=async()=>{if(f&&_&&m.value){V.value=!1;const e={notebookId:_,note:m.value};try{const s=await Fe(f,e);if(P.value=!0,s.error){y(`${s.error}`);return}s.success&&(g.value=!1,h.value=!1,V.value=!1,k.push(`/notebook/${_}`))}catch(s){y(`${s}`);return}}},U=async()=>{V.value&&h.value&&(T.value||h.value)&&!g.value&&(async()=>(await ae(),V.value=!1,h.value=!1,k.push(`${H}`)))()},oe=()=>{T.value=!T.value},me=()=>{x.value=!x.value},ae=async()=>{if(f&&_&&p&&m){let e;try{if(e=await Ye(f,_,p,m.value),e.error){y(`${e.error}`);return}if(e.success)return h.value=!1,V.value=!1,q.value=m.value,T.value&&oe(),e}catch(s){y(`${s}`);return}}else return},be=async()=>{await fetch("/markdown/welcome_markdown_angular.md").then(e=>e.text()).then(e=>{K.value=e})},we=async()=>{if(!g.value&&_&&p&&p!=="create-note"&&!b.value&&f){b.value=!1;try{const e=await qe(f,_,p);if(e.error){y(`${e.error}`);return}e.success&&(m.value=e.note.note,Q.value=e.note.note,q.value=e.note.note,b.value=!0)}catch(e){y(`${e}`);return}}else b.value=!0},he=async()=>{if(!P.value&&f&&_){P.value=!1;try{const e=await Pe(f,_);if(P.value=!0,e.error){y(`${e.error}`);return}e.success&&(n.edited=e.notebook)}catch(e){y(`${e}`),P.value=!0;return}}},se=e=>{f=e.token},y=e=>{l.ShowNotification({notification:{n_status:"error",title:"Error!",message:e}})};return a.$subscribe((e,s)=>{se(s.authContext)}),(async()=>{const e=await a.getAuth();e.value!==null&&(se(e.value),we(),he(),be(),te())})(),(e,s)=>{const X=ke("LoadingScreen");return c(),E(ye,null,[!b.value||C(f)===null?(c(),N(X,{key:0})):v("",!0),d("div",lt,[b.value&&C(f)!==null?(c(),E("div",it,[$(at,{visible:!T.value,splitScreen:x.value,viewText:m.value,updatedViewText:G},null,8,["visible","splitScreen","viewText"]),$(rt,{visible:T.value,splitScreen:x.value,loadedText:Q.value,updateViewText:G,passUpdatedViewText:ee.value},null,8,["visible","splitScreen","loadedText","passUpdatedViewText"])])):v("",!0)]),$(De,null,{default:S(()=>[b.value&&m.value.length>0&&!g.value&&h.value?(c(),N(D,{key:0,size:C(t),rounded:"xl","mat-button":"",color:"secondary","aria-label":"Save Note button",class:"contained medium breadcrumb_edit_fab button_fab",onClick:ae},{default:S(()=>[...s[0]||(s[0]=[d("span",{class:"icon_text"},[d("span",{class:"material-symbols-outlined button_icon white"}," add_circle "),L(" Save Note ")],-1)])]),_:1},8,["size"])):v("",!0),b.value&&m.value.length>0&&g.value?(c(),N(D,{key:1,size:C(t),rounded:"xl","mat-button":"",color:"secondary","aria-label":"Create Note button",class:"contained medium breadcrumb_edit_fab button_fab",onClick:fe},{default:S(()=>[...s[1]||(s[1]=[d("span",{class:"icon_text"},[d("span",{class:"material-symbols-outlined button_icon white"}," add_circle "),L(" Create Note ")],-1)])]),_:1},8,["size"])):v("",!0),b.value&&m.value.length===0&&g.value?(c(),N(D,{key:2,size:C(t),rounded:"xl","mat-button":"",color:"secondary","aria-label":"Example Note button",class:"contained medium breadcrumb_edit_fab button_fab example_button",onClick:_e},{default:S(()=>[...s[2]||(s[2]=[d("span",{class:"icon_text"},[d("span",{class:"material-symbols-outlined button_icon white"}," egg "),L(" Example ")],-1)])]),_:1},8,["size"])):v("",!0),b.value&&!x.value?(c(),N(D,{key:3,size:C(t),rounded:"xl","mat-button":"",color:"secondary","aria-label":"Toggle View button",class:"contained medium breadcrumb_edit_fab button_fab",onClick:oe},{default:S(()=>[T.value?(c(),E("span",ut,[...s[3]||(s[3]=[d("span",{class:"material-symbols-outlined button_icon white"}," visibility ",-1),L(" View ",-1)])])):v("",!0),T.value?v("",!0):(c(),E("span",ct,[...s[4]||(s[4]=[d("span",{class:"material-symbols-outlined button_icon white"}," edit ",-1),L(" Edit ",-1)])]))]),_:1},8,["size"])):v("",!0),b.value&&!z.value?(c(),N(D,{key:4,size:C(t),rounded:"xl","mat-button":"",color:"secondary","aria-label":"Toggle Split Screen button",class:"contained medium breadcrumb_edit_fab button_fab split_screen_button",onClick:me},{default:S(()=>[x.value?(c(),E("span",dt,[...s[5]||(s[5]=[d("img",{src:Ze,alt:"split screen icon",width:"30",height:"30"},null,-1)])])):v("",!0),x.value?v("",!0):(c(),E("span",vt,[...s[6]||(s[6]=[d("img",{src:Ke,alt:"split screen icon",width:"30",height:"30"},null,-1)])]))]),_:1},8,["size"])):v("",!0)]),_:1})],64)}}});export{Tt as default};
